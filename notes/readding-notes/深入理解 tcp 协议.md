# 深入理解 tcp 协议：从原理到实战

- 网络分层模型：每一层之间通过接口沟通，从而提高可维护性。应用层（http）、传输层（tcp）、网络互联层（ip）、网路接口层（ip和硬件部分的沟通，太网、Wifi、蓝牙工作在这一层）

- TCP 是一个可靠的（reliable）、面向连接的（connection-oriented）、基于字节流（byte-stream）、全双工的（full-duplex）协议
  - 面向连接：面向连接的协议要求正式发送数据之前需要通过「握手」建立一个逻辑连接，结束通信时也是通过有序的四次挥手来断开连接。而无连接，可以认为不建连就开始发送数据，不关注对方是否能收到
  - IP 是一种无连接、不可靠的协议：它尽最大可能将数据报从发送者传输给接收者，但并不保证包到达的顺序会与它们被传输的顺序一致，也不保证包是否重复，甚至都不保证包是否会达到接收者。因此 tcp 为了保证可靠必须解决包完整性校验、乱序、重复、超时重传、流量控制等问题
  - 字节流协议：流的含义是没有固定的报文边界。应用层向 socket 写入的数据，tcp 层会按照自己优化规则，将写入的数据分一个、多个报文发送，接收方（应用层）不知道发送方每次发了多少数据，因此只能在应用层定义包的边界（比如 http 的换行符）。比如，应用层分两次写入 500 + 800 字节的数据，tcp 拆分为 300 + 1000发送，接收方（tcp）按照 400 + 900 接收
  - 全双工的协议：在 TCP 中发送端和接收端可以是客户端/服务端，也可以是服务器/客户端，通信的双方在任意时刻既可以是接收数据也可以是发送数据，每个方向的数据流都独立管理序列号、滑动窗口大小、MSS 等信息